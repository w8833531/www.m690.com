---
title: Centos 7.1 多网卡服务器pxe安装
tags:
  - centos7.1
  - eth
  - kickstart
  - pxe
  - 网卡名
id: 946
categories:
  - linux
date: 2015-09-15 17:33:39
---

> Centos7.1已经上市一段时间了，一直没有去装着试一下。今天有时间了，可以安装一下看看了。本来centos的pxe安装应该熟门熟路了，但还是碰到了一些问题。把相关配置有要注意的问题记录如下。
解决问题：
1、因为第一、二块网卡是没有链接的，所以pxe检查时间非常长
2、安装完成后的机器网卡是一个非常奇怪的名字，非常不利于后面的管理。后来改了kickstart相关参数后，安装后的机器回复成ethx的网卡设备名了。
3、建议用kickstart配置文件中关闭NetworkManager这个服务，不然后面配置网卡很麻烦。

1、服务器硬件配置：
System Information：
        Manufacturer: IBM
        Product Name: BladeCenter HS23 
        Intel(R) Xeon(R) CPU E5-2609 0 @ 2.40GHz *8
        MEM:16G
        Netcard  *4 （有4块网卡，而且有链接的网卡不是第一块，在第三块）
2、dhcpd 配置(这里面是没有什么可以说的）：
<pre>
#cat /etc/dhcpd.conf
ddns-update-style ad-hoc;
default-lease-time 21600;
max-lease-time 43200;
option time-offset -18000;
shared-network all-network{

subnet 10.100.0.0 netmask 255.255.248.0 {
    authoritative;
    option domain-name "mgmt.share.lab";
    option domain-name-servers 10.100.0.2;
    range 10.100.2.100 10.100.2.254;
    next-server 10.100.0.2;
    filename "pxelinux.0";
#    option routers 10.100.0.254;
    option subnet-mask 255.255.248.0;
}
</pre>
3、tftp的配置如下：
<pre>
# cat /opt/tftp/data/bootmenu/centos
DEFAULT menu.c32
TIMEOUT 120
MENU TITLE NBOSD  Centos

LABEL default
        MENU LABEL ^Back to Main Menu
        KERNEL menu.c32
        APPEND /pxelinux.cfg/default

label install_centos71_64
kernel install_centos71_64
MEMU LABEL Install Centos71_64
#注意我加了一下ksdevice=bootif net.ifnames=0 biosdevname=0三个参数，ksdevice=bootif从pxe启动的网卡启动，这样可以节约检查两个没有链接的网卡的时间，net.ifnames=0 biosdevname=0这两个参数用来把网卡名固定人thex
append  load_ramdisk=1 ramdisk_size=1638400 initrd=install_centos71_64.img  inst.ks=http://10.100.0.2/os/mini71_64.cfg ksdevice=bootif net.ifnames=0 biosdevname=0
ipappend 2
</pre>

kickstart 配置
<pre>
# cat mini71_64.cfg
# Kickstart file automatically generated by anaconda.
install
url --url http://10.100.0.2/os/centos/7.1/os/x86_64
text
#repo --name="CentOS" --baseurl=http://10.100.0.2/os/centos/7.1/os/x86_64
reboot
#poweroff

keyboard us
lang en_US
#注意一下，--device=bootif同上，这样可以节约检查两个没有链接的网卡的时间
network --device=bootif --bootproto=dhcp  --onboot=yes --noipv6 --hostname=cnetos7.1
timezone Asia/Shanghai --isUtc

rootpw password
authconfig --enableshadow --enablemd5
firstboot --disabled
logging --level=debug

###启动ssh服务，关闭NetworkManager, tuned
services --enabled sshd
services --disabled NetworkManager, tuned

firewall --disabled
selinux --disabled
skipx
###这个是关键， --append="net.ifnames=0 biosdevname=0" 用于把安装后的机器的网卡设置成ethx的设备，而不是其它奇怪的名字
#bootloader --location=mbr --driveorder=sda --append="tsc=reliable divider=10 plymouth.enable=0 console=ttyS0"
bootloader --location=mbr --driveorder=sda,sdb --append="net.ifnames=0 biosdevname=0" 
#bootloader --location=mbr --driveorder=sda,sdb 
zerombr
clearpart --all --initlabel
#ignoredisk --only-use=sda

#autopart --nolvm
part /boot --asprimary --fstype="xfs"  --size=100
part /  --fstype="xfs" --size=4096
part swap --fstype="swap" --size=8192
part /var  --fstype="xfs"  --size=4096
part /opt  --fstype="xfs" --size=1 --grow

%packages --nobase
@core
acpid
iputils
man
net-tools
ntp
ntpdate
parted
vim-common
vim-enhanced
vim-minimal
wget
%end
#%pre
#%post
</pre>